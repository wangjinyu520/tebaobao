(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/businessSon/chat"],{"297b":function(t,e,n){"use strict";n.r(e);var o=n("3122"),i=n("3a61");for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);n("aa9e");var s,r=n("f0c5"),c=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"5dfbc37c",null,!1,o["a"],s);e["default"]=c.exports},3122:function(t,e,n){"use strict";var o,i=function(){var t=this,e=t.$createElement;t._self._c},a=[];n.d(e,"b",function(){return i}),n.d(e,"c",function(){return a}),n.d(e,"a",function(){return o})},"3a61":function(t,e,n){"use strict";n.r(e);var o=n("c305"),i=n.n(o);for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a);e["default"]=i.a},"5a36":function(t,e,n){"use strict";(function(t){n("fdb5"),n("921b");o(n("66fd"));var e=o(n("297b"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},aa9e:function(t,e,n){"use strict";var o=n("ceb9"),i=n.n(o);i.a},c305:function(t,e,n){"use strict";(function(t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;i(n("8ced"));function i(t){return t&&t.__esModule?t:{default:t}}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){s(t,e,n[e])})}return t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var r=function(){return n.e("components/im-chat/chatinput").then(n.bind(null,"f9eb"))},c=function(){return n.e("components/im-chat/messageshow").then(n.bind(null,"94b0"))},u=function(){return n.e("components/im-chat/Emoji").then(n.bind(null,"826a"))},d=n("ae2f"),g={data:function(){return{style:{pageHeight:0,contentViewHeight:0,footViewHeight:110,mitemHeight:0},isAnimation:!1,scrollTop:0,showEoji:!1,focus:!1,inputValue:"",pageShow:!1,msgList:[],avatar:"",toId:"",toUserId:""}},components:{chatInput:r,messageShow:c,Emoji:u},onLoad:function(){var e=this;this.$loading();var n=JSON.parse(t.getStorageSync("userInfo"));this.avatar=n.headimgurl,this.toUserId=this.$mp.query.toId;var o=t.getSystemInfoSync();this.style.pageHeight=o.windowHeight,this.style.contentViewHeight=o.windowHeight-t.getSystemInfoSync().screenWidth/750*100,d.sendSocketMessage({data:JSON.stringify({type:"readmsg",data:{fromid:t.getStorageSync("token"),toid:this.$mp.query.toId}})}),d.sendSocketMessage({data:JSON.stringify({type:"history",data:{fromid:t.getStorageSync("token"),toid:this.$mp.query.toId}})}),d.onSocketMessageCallback=function(n){var o=JSON.parse(n.data);if("say"===o.type){var i=o;i.data.to_headimgurl=i.data.toid===t.getStorageSync("token")?i.data.from_headimgurl:i.data.to_headimgurl,i.data.message=e.$utils.generateRichTextNode(i.data.message,i.data.message_type),e.msgList.push(i.data),e.$nextTick(function(){setTimeout(function(){e.scrollToBottom()},50)})}if("history"===o.type){var a=o.data;e.msgList=a.map(function(n){return n.to_headimgurl=n.toid===t.getStorageSync("token")?n.from_headimgurl:n.to_headimgurl,n.message=e.$utils.generateRichTextNode(n.message,n.message_type),n}),e.$nextTick().then(function(){setTimeout(function(){e.scrollToBottom()},50)})}},this.$hideLoading(),this.pageShow=!0},onUnload:function(){d.sendSocketMessage({data:JSON.stringify({type:"readmsg",data:{fromid:t.getStorageSync("token"),toid:this.$mp.query.toId}})})},onBackPress:function(){d.sendSocketMessage({data:JSON.stringify({type:"readmsg",data:{fromid:t.getStorageSync("token"),toid:this.$mp.query.toId}})})},methods:{sendMsg:function(t){var e=this;d.sendSocketMessage({data:JSON.stringify(a({},t))});var n=t;n.data.message=this.$utils.generateRichTextNode(n.data.message,n.data.message_type),this.msgList.push(n.data),setTimeout(function(){e.scrollToBottom()},50)},onShowEmoji:function(e,n){var o=this;e?(this.showEoji=!1,this.focus=!0):(t.hideKeyboard(),setTimeout(function(){o.showEoji=!0,o.focus=!1},300))},hideKeyboard:function(){this.showEoji=!1,t.hideKeyboard()},updataVal:function(t){this.inputValue=t},onUpload:function(){var e=this;this.showEoji=!1,this.$utils.chooseImg().then(function(n){e.$loading("上传中"),t.uploadFile({url:"https://nycs.maitexun.cn/apicloud/find/uploadspic",filePath:n.tempFilePaths[0],name:"file",success:function(o){var i=JSON.parse(o.data);200===i.code?t.getImageInfo({src:n.tempFilePaths[0],success:function(n){var o=0,a=0;n.width>400?(o=t.upx2px(400),a=t.upx2px(n.height*(400/n.width))):(o=t.upx2px(n.width),a=t.upx2px(n.height));var s={type:"say",data:{userType:"customer",fromid:t.getStorageSync("token"),toid:e.toUserId,message:i.data.src.wz,message_type:"img",width:o,height:a}};e.$hideLoading(),e.sendMsg(s)}}):e.$toast(i.msg)},fail:function(t){e.$hideLoading()}})})},getInputMessage:function(e){var n={type:"say",data:{userType:"customer",fromid:t.getStorageSync("token"),toid:this.toUserId,message:e.content,message_type:"text"}};this.sendMsg(n),this.showEoji=!1,this.inputValue=""},scrollToBottom:function(){var e=this,n=t.createSelectorQuery();n.selectAll(".m-item").boundingClientRect(),n.select("#scrollview").boundingClientRect(),n.exec(function(t){e.style.mitemHeight=0,t[0].forEach(function(t){o("info",t.height,2222," at pages\\businessSon\\chat.vue:275"),e.style.mitemHeight=e.style.mitemHeight+t.height+20}),o("log",e.style.mitemHeight,e.style.contentViewHeight," at pages\\businessSon\\chat.vue:278"),e.scrollTop=e.scrollTop+1e4,e.style.mitemHeight>e.style.contentViewHeight&&(e.scrollTop=e.style.mitemHeight-e.style.contentViewHeight)})}}};e.default=g}).call(this,n("6e42")["default"],n("0de9")["default"])},ceb9:function(t,e,n){}},[["5a36","common/runtime","common/vendor"]]]);